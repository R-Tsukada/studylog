# 新規ユーザーオンボーディング機能 要件定義書

## 📋 1. 機能概要

**目的：** 初回ログイン・登録時のユーザーに対して、アプリの使い方を分かりやすく説明し、スムーズな利用開始を促進する

**対象ユーザー：**
- 新規登録したユーザー
- 初回ログインユーザー（OAuth認証含む）
- オンボーディングをスキップした後、再度確認したいユーザー

## 📋 2. 機能要件

### 2.1 基本機能
- **初回ログイン・登録時の自動表示**
  - 新規登録完了後、またはOAuth初回ログイン後に自動表示
  - 背景グレーアウト付きのモーダル形式
  - ユーザーが明示的にスキップまたは完了するまで表示

### 2.2 オンボーディング表示条件（改訂版）
```typescript
interface OnboardingDisplayCondition {
  // 1. 既に完了している場合は表示しない
  hasCompleted: boolean;
  
  // 2. 登録から30日以内（7日→30日に変更）
  daysSinceRegistration: number; // <= 30
  
  // 3. ログイン回数が5回以下（新規ユーザー判定）
  loginCount: number; // <= 5
  
  // 4. 管理者による強制無効化チェック
  isDisabledByAdmin: boolean;
}
```

### 2.3 ガイド内容
1. **Step 1: ウェルカムメッセージ**
   - アプリの簡単な紹介
   - 学習記録の目的・メリット説明

2. **Step 2: インタラクティブ初期設定**
   - 試験種別の選択（必須）
   - 学習分野の設定（必須）
   - 学習目標の設定（オプション）
   - **実際に設定を行わせる**形式

3. **Step 3: 基本機能説明**
   - ダッシュボードの見方
   - 学習セッションの開始方法
   - ポモドーロタイマーの使い方

4. **Step 4: 完了・設定画面への誘導**
   - 設定画面の場所
   - 重要な設定項目の説明

### 2.4 UI/UX要件
- **レスポンシブ対応**：モバイル・デスクトップ両対応
- **ステップ式ガイド**：4画面でのステップバイステップ形式
- **進捗表示**：現在のステップと全体の進捗を表示
- **スキップ機能**：いつでもスキップ可能（確認ダイアログ付き）
- **再表示機能**：設定画面から再度閲覧可能

### 2.5 エッジケース・アクセシビリティ対応
- **中断・復帰**：ブラウザ閉じる→再開時の状態復元
- **複数タブ**：BroadcastChannel APIでの状態同期
- **ネットワーク不安定**：オフライン検知と同期機能
- **キーボードナビゲーション**：Tab、矢印キー、Escapeキー対応
- **スクリーンリーダー**：ARIA属性、ライブリージョン対応

## 📋 3. 非機能要件

### 3.1 パフォーマンス
- モーダル表示まで500ms以内
- ステップ間の遷移は300ms以内
- 軽量な画像・アニメーション使用

### 3.2 ユーザビリティ
- 直感的な操作（次へ・戻る・スキップボタン）
- キーボードナビゲーション対応
- 読みやすいフォントサイズ・色使い

### 3.3 互換性
- モダンブラウザ対応（Chrome、Firefox、Safari、Edge）
- レスポンシブデザイン対応

## 📋 4. 制約条件

### 4.1 技術制約
- 既存のVue.js 3 + Composition APIアーキテクチャ
- TailwindCSS 4.0を使用
- Laravel Sanctum認証システムとの連携

### 4.2 デザイン制約
- 既存のカラーパレット・デザインシステムを継承
- アクセシビリティ準拠（WCAG 2.1 AA レベル）

## 📋 5. ユーザーストーリー

### シナリオ1: 新規ユーザーの初回登録
```gherkin
前提条件: ユーザーが新規登録を完了した
ケース: 初回オンボーディング表示
  1. 登録完了後、自動的にオンボーディングモーダルが表示される
  2. ユーザーはウェルカムメッセージを確認する
  3. 「次へ」ボタンで初期設定ガイドに進む
  4. 試験種別・学習分野を実際に選択・設定する
  5. 基本機能の説明を読む
  6. 「完了」ボタンでオンボーディング終了
  7. ダッシュボードに遷移し、設定完了状態を確認
```

### シナリオ2: オンボーディングスキップ
```gherkin
ケース: ユーザーがスキップを選択
  1. 任意のステップで「スキップ」ボタンをクリック
  2. 確認ダイアログ表示（「後で設定画面から確認できます」）
  3. 「はい」でオンボーディング終了
  4. ダッシュボード表示（初期設定未完了の状態）
```

### シナリオ3: 中断・復帰
```gherkin
ケース: オンボーディング途中でブラウザを閉じる
  1. オンボーディングのStep 2で作業中
  2. ブラウザを閉じる
  3. 再度ログイン
  4. 「続きから始めますか？」ダイアログ表示
  5. 「続きから」選択でStep 2から再開
```

### シナリオ4: オンボーディング再表示
```gherkin
ケース: 設定画面からの再表示
  1. 設定画面の「使い方ガイド」ボタンをクリック
  2. オンボーディングモーダル再表示
  3. 任意のステップから閲覧・操作可能
```

## 📋 6. 受け入れ基準

### 6.1 機能面
- [ ] 新規登録後、オンボーディングが自動表示される
- [ ] OAuth初回ログイン後も自動表示される
- [ ] 全てのステップが正常に動作する
- [ ] Step 2で実際に設定を行うことができる
- [ ] スキップ機能が正常に動作する（確認ダイアログ付き）
- [ ] 設定画面から再表示できる
- [ ] モバイル・デスクトップで適切に表示される
- [ ] 中断・復帰が正常に動作する

### 6.2 品質面
- [ ] ローディング時間が要求を満たす
- [ ] アクセシビリティ基準を満たす
- [ ] 既存機能への影響がない
- [ ] 適切なエラーハンドリング
- [ ] キーボードナビゲーション対応
- [ ] スクリーンリーダー対応

### 6.3 データ面
- [ ] オンボーディング状態が正しく保存される
- [ ] 分析用ログが適切に記録される
- [ ] ユーザー行動データが収集できる

## 📋 7. API仕様概要

### 7.1 統一APIレスポンス形式
```typescript
interface ApiResponse<T = any> {
  success: boolean;
  message: string;
  data?: T;
  errors?: Record<string, string[]>;
  meta: {
    timestamp: string;
    requestId: string;
    version: string;
  };
}
```

### 7.2 主要エンドポイント
- `GET /api/onboarding/status` - オンボーディング状態取得
- `POST /api/onboarding/progress` - 進捗更新
- `POST /api/onboarding/complete` - 完了処理  
- `POST /api/onboarding/skip` - スキップ処理

## 📋 8. 分析・改善指標

### 8.1 KPI
- **完了率**：オンボーディング完了ユーザー数 / 表示ユーザー数
- **ステップ別離脱率**：各ステップでの離脱ユーザー数
- **平均所要時間**：開始から完了までの時間
- **再表示率**：設定画面からの再表示回数

### 8.2 ユーザー行動分析
- ステップごとの滞在時間
- スキップ理由の分析
- デバイス別の完了率比較
- 完了ユーザーの継続利用率

## 📋 9. 今後の拡張計画

### 9.1 A/Bテスト対応
- ステップ数の最適化実験
- コンテンツ内容の効果測定
- UI デザインのバリエーション検証

### 9.2 パーソナライゼーション
- ユーザーの学習分野に応じたカスタマイズ
- 過去の行動履歴に基づく最適化
- デバイス・環境に応じた表示調整

### 9.3 多言語対応
- 英語版オンボーディング
- 中国語・韓国語対応
- RTL言語対応