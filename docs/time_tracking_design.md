# 時間計測・ポモドーロ機能 設計ドキュメント

## 概要

本資格学習アプリでは、学習時間の計測について2つの異なるアプローチを提供しています：

1. **時間計測機能**: 自由な時間で学習を計測
2. **ポモドーロ機能**: 構造化された時間管理（ポモドーロテクニック）

これらの機能は完全に分離された設計となっており、ユーザーは学習スタイルに応じて最適な方法を選択できます。

## 設計思想・UX方針

### なぜ2つの機能を分離したのか

#### 1. 学習スタイルの多様性への対応
- **集中型学習者**: 長時間の読書や深い思考が必要な学習を好む
- **構造化学習者**: 短時間の集中と休憩を繰り返すことで効率を上げる

#### 2. 機能の純粋性保持
- 時間計測とポモドーロは根本的に異なる学習手法
- 混在させるとどちらの利点も薄れる可能性
- 専用UIで各手法の特徴を最大化

#### 3. 将来の拡張性・保守性
- 片方の機能を削除/変更しても他方に影響しない
- 新機能追加時の影響範囲を限定
- A/Bテストや機能実験が容易

#### 4. ユーザビリティの向上
- 明確な機能分離により混乱を防止
- 各機能に特化したUIで操作効率向上
- 初心者でも迷わず選択可能

## アーキテクチャ設計

### システム全体構成

```
Frontend (Vue.js)
├── StudySession.vue     # 時間計測専用コンポーネント
├── PomodoroTimer.vue    # ポモドーロ専用コンポーネント
└── App.vue             # グローバル状態管理

Backend (Laravel)
├── StudySession Model/API      # 時間計測データ
├── PomodoroSession Model/API   # ポモドーロデータ
└── 完全分離されたテーブル構造
```

### データベース設計

#### 時間計測テーブル (study_sessions)
```sql
study_sessions
├── id
├── user_id
├── subject_area_id     # 学習分野
├── started_at         # 開始時刻
├── ended_at           # 終了時刻
├── duration_minutes   # 学習時間（分）
├── notes             # メモ
└── created_at/updated_at
```

#### ポモドーロテーブル (pomodoro_sessions)
```sql
pomodoro_sessions
├── id
├── user_id
├── subject_area_id      # 学習分野（直接記録）
├── session_type         # focus/short_break/long_break
├── planned_duration     # 予定時間（分）
├── actual_duration      # 実際の時間（分）
├── started_at          # 開始時刻
├── completed_at        # 完了時刻
├── is_completed        # 完了フラグ
├── was_interrupted     # 中断フラグ
├── settings           # JSON設定
├── notes             # メモ
└── created_at/updated_at
```

### API設計

#### 時間計測API
```
GET    /api/study-sessions        # 学習セッション一覧
POST   /api/study-sessions        # 学習開始
PUT    /api/study-sessions/{id}   # 学習終了・更新
DELETE /api/study-sessions/{id}   # 削除
GET    /api/study-sessions/stats  # 統計情報
```

#### ポモドーロAPI
```
GET    /api/pomodoro              # ポモドーロ一覧
POST   /api/pomodoro              # セッション開始
PUT    /api/pomodoro/{id}         # セッション更新
POST   /api/pomodoro/{id}/complete # セッション完了
GET    /api/pomodoro/current      # 現在のセッション
GET    /api/pomodoro/stats        # 統計情報
DELETE /api/pomodoro/{id}         # 削除
```

## 機能要件

### 時間計測機能

#### 基本機能
- **学習開始/終了**: ワンクリックで時間計測開始・終了
- **学習分野選択**: 何を学習するかを記録
- **メモ機能**: 学習内容や気づきを記録
- **履歴表示**: 過去の学習セッション一覧

#### 特徴
- 時間制限なし（数分〜数時間対応）
- 中断・再開機能
- バックグラウンド動作なし（シンプル設計）

#### ユースケース
- 長時間の読書・資料読み込み
- 問題集の解答（時間を気にせず）
- 動画学習・講義視聴
- 研究・調査活動

### ポモドーロ機能

#### 基本機能
- **セッション管理**: 集中/休憩セッションの管理
- **タイマー機能**: カウントダウンタイマー
- **自動通知**: セッション完了時の音声・ブラウザ通知
- **設定カスタマイズ**: 時間設定、自動開始等

#### セッションタイプ
- **集中セッション**: 15分/25分/50分から選択
- **短い休憩**: 5分/10分/15分から選択
- **長い休憩**: 15分/20分/30分から選択

#### 高度な機能
- **バックグラウンド動作**: ページ切り替え時もタイマー継続
- **状態同期**: ブラウザ再起動時の状態復元
- **統計機能**: 完了率、集中時間、中断回数等
- **中断・再開**: 一時停止・再開機能

#### ユースケース
- 短時間集中での暗記作業
- 問題演習（時間を区切って）
- 集中力維持が困難な長時間学習
- 効率的な休憩管理

## UX設計

### ナビゲーション設計

#### ボトムナビゲーション
```
📊 ダッシュボード | ⏰ 時間計測 | 🍅 ポモドーロ | 📚 学習履歴 | ⚙️ 設定
```

#### 機能間の相互案内
- **時間計測画面**: ポモドーロ機能の紹介カード表示
- **ポモドーロ画面**: 時間計測機能の紹介カード表示
- **明確な使い分け説明**: それぞれの特徴を分かりやすく説明

### ユーザーフロー

#### 初回利用時
1. ダッシュボードで両機能の説明を表示
2. 学習スタイルに応じた推奨機能を提案
3. 各機能で簡単なチュートリアル

#### 日常利用時
1. 学習内容に応じて機能選択
2. 直感的な操作で学習開始
3. 統計情報で学習進捗を確認

## 技術実装

### フロントエンド（Vue.js 3）

#### グローバル状態管理
```javascript
// App.vue - グローバルポモドーロタイマー
globalPomodoroTimer: reactive({
  isActive: false,
  currentSession: null,
  timeRemaining: 0,
  startTime: 0,
  timer: null
})
```

#### コンポーネント分離
- **StudySession.vue**: 時間計測専用、シンプルなUI
- **PomodoroTimer.vue**: ポモドーロ専用、高機能UI
- **完全独立**: 相互依存なし

### バックエンド（Laravel 11）

#### モデル設計
```php
// StudySession.php - 時間計測
class StudySession extends Model
{
    public function subjectArea(): BelongsTo
    public function user(): BelongsTo
    // シンプルなスコープとアクセサ
}

// PomodoroSession.php - ポモドーロ
class PomodoroSession extends Model
{
    public function subjectArea(): BelongsTo
    public function user(): BelongsTo
    // 複雑なスコープとビジネスロジック
}
```

#### API設計方針
- **RESTful設計**: 標準的なHTTPメソッド使用
- **認証必須**: Laravel Sanctum使用
- **バリデーション**: 厳密な入力検証
- **エラーハンドリング**: 適切なHTTPステータス

## 将来の拡張計画

### 時間計測機能
- **目標設定**: 日/週/月の学習時間目標
- **タグ機能**: 学習内容の詳細分類
- **CSV出力**: 学習記録のエクスポート

### ポモドーロ機能
- **サイクル管理**: 4セッション1サイクルの自動管理
- **音声カスタマイズ**: 通知音の選択機能
- **集中度評価**: セッション後の集中度記録

### 共通機能
- **学習分析**: AI を使った学習パターン分析
- **レポート機能**: 週次/月次レポート自動生成
- **同期機能**: 複数デバイス間のデータ同期

## 保守・運用

### 監視項目
- **使用率**: 各機能の利用頻度
- **完了率**: セッション完了率
- **エラー率**: API エラー発生率

### パフォーマンス
- **データベース**: インデックス最適化
- **API**: レスポンス時間監視
- **フロントエンド**: バンドルサイズ最適化

## 結論

時間計測とポモドーロ機能の完全分離により、以下を実現：

1. **ユーザビリティ向上**: 明確な機能分離と専用UI
2. **技術的柔軟性**: 独立した開発・保守
3. **拡張性**: 将来の機能追加が容易
4. **学習効果**: 各手法の特徴を最大化

この設計により、多様な学習スタイルに対応しつつ、保守性の高いシステムを構築できました。